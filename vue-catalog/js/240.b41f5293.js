"use strict";(self["webpackChunkvue_catalog"]=self["webpackChunkvue_catalog"]||[]).push([[240],{1749:function(e,t,s){s.d(t,{Z:function(){return C}});var o=s(3396),l=s(7139),i=s(9242);const r={class:"graybg"},n=["href"],a=["src"],d={class:"picName"},c=["href"],u=["onClick"],p=["src"],h={class:"multiSelect mb-15"},g={class:"flex mr-15"},f=(0,o._)("br",null,null,-1),m=["disabled"],b={class:"mt-20 mb-10"},P=(0,o._)("br",null,null,-1),w={class:"progress"},_={class:"pl-15"},k=["src"],v={className:"picName"},y=["onClick"],F=["src"];function $(e,t,s,$,T,B){return(0,o.wg)(),(0,o.iD)("div",r,[e.$store.state.updProd.pictures?((0,o.wg)(),(0,o.iD)("div",{key:0,class:(0,l.C_)(["pl-15 smooth",e.$store.state.updProd.pictures.length>0&&"picsArrBg pt-15 pb-6 smooth-show"])},[(0,o._)("ul",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.$store.state.updProd.pictures,(e=>((0,o.wg)(),(0,o.iD)("li",{key:e,class:(0,l.C_)(["flex-list",e.includes("_COPY")&&"orange"])},[(0,o._)("a",{href:$.define.pathToUploads+"/"+e,className:"",target:"_blank",rel:"noreferrer noopener",title:""},[(0,o._)("img",{src:$.define.prevFolder2+e,class:"prev",alt:""},null,8,a)],8,n),(0,o._)("div",d,[(0,o._)("a",{href:$.define.pathToUploads+"/"+e,className:"",target:"_blank",rel:"noreferrer noopener",title:"Открыть в новой вкладке"},(0,l.zw)(e.length>$.maxNameLength?e.substr(0,$.maxNameLength-13)+" ... "+e.substr(-8,8):e),9,c)]),(0,o._)("div",{class:"delPic",onClick:t=>B.preparePicToDelete(e)},[(0,o._)("img",{src:$.define.pathToGraphics+"/delete2_20px.png",alt:""},null,8,p)],8,u)],2)))),128))])],2)):(0,o.kq)("",!0),(0,o._)("div",h,[(0,o._)("div",g,[(0,o._)("input",{type:"file",id:"files",ref:"files",accept:".png, .jpg, .jpeg, .gif",multiple:"",onChange:t[0]||(t[0]=e=>B.handleFilesUpload())},null,544),f,(0,o._)("button",{disabled:T.uplBtnBlock,onClick:t[1]||(t[1]=e=>B.submitFiles())},(0,l.zw)(s.uploadButton),9,m)]),(0,o._)("div",{class:(0,l.C_)(["smooth",T.isInProgress&&"smooth-show",""])},[(0,o._)("div",b,[(0,o.Uk)((0,l.zw)(T.uploadPercentage)+" % ",1),P,(0,o._)("div",w,[(0,o._)("div",{class:"progress-bar",style:(0,l.j5)({width:+T.uploadPercentage+"%"})},null,4)])])],2),(0,o.Wm)(i.uT,{name:"fade"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o._)("div",{class:"mt-10 mb-10"},(0,l.zw)(s.uploadedFiles)+" ("+(0,l.zw)(T.newPics.length)+"):",513),[[i.F8,T.newPics.length>0]])])),_:1}),(0,o._)("ul",_,[(0,o.Wm)(i.W3,{name:"list"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(T.newPics,(e=>((0,o.wg)(),(0,o.iD)("li",{key:e,class:(0,l.C_)(["flex-list",e.includes("_COPY")&&"orange"])},[(0,o._)("img",{src:$.define.prevFolder+e,class:"prev",alt:""},null,8,k),(0,o._)("div",v,(0,l.zw)(e.length>$.maxNameLength?e.substr(0,$.maxNameLength-13)+" ... "+e.substr(-8,8):e),1),(0,o._)("div",{className:"delPic",onClick:t=>B.deleteNewPics(e)},[(0,o._)("img",{src:$.define.pathToGraphics+"/delete2_20px.png",alt:""},null,8,F)],8,y)],2)))),128))])),_:1})])])])}var T=s(6265),B=s.n(T),D=s(523),x={props:{uploadButton:{type:String,default:"Загрузить"},uploadedFiles:{type:String,default:"Загружены файлы"}},data(){return{files:"",newPics:[],picsToDelete:[],isInProgress:!1,uploadPercentage:0,uplBtnBlock:!0}},methods:{handleFilesUpload(){this.files=this.$refs.files.files,this.isInProgress=!0,console.log("this.$refs.files.files.length: ",this.$refs.files.files.length),this.$refs.files.files.length>0?this.uplBtnBlock=!1:this.uplBtnBlock=!0},async submitFiles(){let e;this.uploadPercentage=0,this.uplBtnBlock=!0;let t=new FormData;for(let o=0;o<this.files.length;o++)e=this.files[o],t.append("files["+o+"]",e);try{const e=await B()({method:"post",url:D.Ou.pathToAPI+"/multiupload/multiupload.php",data:t,withCredentials:!0,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){this.uploadPercentage=Math.round(100*e.loaded/e.total)}.bind(this)});if(console.log("response: ",e),!e.data.uplFiles)return console.log("! Не получен response.data.uplFiles"),void alert("Ошибка на сервере при сохранении файлов (см. консоль)");if(e.data){this.$store.commit("SetFreeze",!0);for(let t=0;t<e.data.uplFiles.length;t++)this.newPics.includes(e.data.uplFiles[t])||this.newPics.push(e.data.uplFiles[t])}else alert("Ошибка (см. консоль)"),console.log("Ошибка при передаче или сохранении файлов.\nСервер отвечает (код 200). Но нет подтверждения от multiupload.php, что файлы сохранены")}catch(s){console.log(s)}},preparePicToDelete(e){if(!e&&"string"!==typeof e)return void console.log("Ошибка: filename не передан или не string [см. preparePicToDelete()]");this.$store.commit("SetFreeze",!0);const t=this.$store.state.updProd.pictures.filter((t=>t!==e));this.picsToDelete.push(e),this.$store.commit("UpdatePicsInDB",t)},delPicsToDelete(){this.picsToDelete.length>0&&this.deleteFiles(this.picsToDelete),this.picsToDelete=[]},async deleteNewPics(e){if(!this.newPics.length)return;console.log("1) filesToBeDel: ",e),console.log("typeof: ",typeof e),e="string"===typeof e?[e]:this.newPics,console.log("2) filesToBeDel: ",e),console.log("Удалить из newPics то что вернет deleteFiles() ");let t=await this.deleteFiles(e);if(t){for(let e=0;e<t.length;e++)this.newPics=this.newPics.filter((s=>s!==t[e]));0===this.newPics.length&&this.hideBarAndClean()}else console.log("deletedFiles - false")},async deleteFiles(e){if(e&&"string"!==typeof e)try{const t=await B()({method:"post",url:D.Ou.pathToAPI+"/multiupload/delete_uplfiles.php",data:{filesToBeDel:e},withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}});return console.log("response: ",t),t.data?0===t.data.doneFiles.length?(console.log("~~~"),console.log("Нет подтверждения от сервера"),console.log("Комментарии: ",t.data.comments),console.log("response: ",t),console.log("~~~"),void alert("Нет подтверждения от сервера (см. консоль)")):t.data.doneFiles:(alert("Ошибка (см. консоль)"),void console.log("Ошибка при передаче или сохранении файлов.\nСервер отвечает (код 200). Но нет подтверждения от multiupload.php, что файлы сохранены"))}catch(t){return void console.log(t)}else console.log("Ошибка: функции deleteFiles не передан массив (обязательный параметр)")},getBackFiles(){this.picsToDelete.length>0&&this.$store.commit("AddToPicsInDB",this.picsToDelete),this.picsToDelete=[]},hideBarAndClean(){this.newPics.length>0&&(this.newPics=[]);const e=350,t=600;setTimeout((()=>{this.isInProgress=!1}),e),this.$refs.files.value="",setTimeout((()=>{this.uploadPercentage=0}),e+t)}},setup(){return{define:D.Ou,maxNameLength:D.AS}}},N=s(89);const U=(0,N.Z)(x,[["render",$]]);var C=U},9240:function(e,t,s){s.r(t),s.d(t,{default:function(){return X}});var o=s(3396),l=s(7139);const i={class:"home"},r={key:0},n=["src"],a={key:1},d={key:0},c={key:1};function u(e,t,s,u,p,h){const g=(0,o.up)("login-form"),f=(0,o.up)("form-edit");return(0,o.wg)(),(0,o.iD)("div",i,[(0,o._)("h1",null,(0,l.zw)(u.insert[u.lang].header),1),e.$store.state.isAuthLoading?((0,o.wg)(),(0,o.iD)("div",r,[(0,o._)("img",{src:u.define.pathToGraphics+"/loaders/loader_1_32px.gif",alt:""},null,8,n)])):((0,o.wg)(),(0,o.iD)("div",a,[e.$store.state.isAuth?((0,o.wg)(),(0,o.iD)("div",c,[(0,o.Wm)(f,{insert:u.insert[u.lang]},null,8,["insert"])])):((0,o.wg)(),(0,o.iD)("div",d,[(0,o.Wm)(g)]))]))])}var p=s(2373),h=s(9242);const g={key:0},f=["src"],m={key:1},b={key:0},P=(0,o.Uk)(" ID: "),w={class:"form-group mb-10"},_=["placeholder","value"],k={class:"form-group mb-10"},v=["placeholder","value"],y={class:"form-group mb-20"},F=["value"],$=(0,o._)("hr",{class:"w540 hr-dashed"},null,-1),T={class:"form-group mb-10"},B=["placeholder"],D={class:"form-group mb-10"},x=["placeholder"],N={key:1},U=(0,o.Uk)(" ID: "),C=(0,o._)("br",null,null,-1),E=["innerHTML"];function L(e,t,s,i,r,n){const a=(0,o.up)("multi-upload");return e.$store.state.isProdsLoading?((0,o.wg)(),(0,o.iD)("div",g,[(0,o._)("img",{src:i.define.pathToGraphics+"/loaders/loader_1_32px.gif",alt:""},null,8,f)])):((0,o.wg)(),(0,o.iD)("div",m,[e.$store.state.updProd.id>0?((0,o.wg)(),(0,o.iD)("div",b,[P,(0,o._)("b",null,(0,l.zw)(e.$route.params.id),1),(0,o._)("form",{onSubmit:t[6]||(t[6]=(0,h.iM)((()=>{}),["prevent"])),class:"mt-10"},[(0,o.Uk)((0,l.zw)(s.insert.brandLabel)+": ",1),(0,o._)("div",w,[(0,o._)("input",{class:(0,l.C_)(["form-control w540",{notfilled:r.isFilled1}]),placeholder:s.insert.brandPlaceholder,value:e.$store.state.updProd.brand,onInput:t[0]||(t[0]=(...e)=>n.inputBrand&&n.inputBrand(...e))},null,42,_)]),(0,o.Uk)(" "+(0,l.zw)(s.insert.modelLabel)+": ",1),(0,o._)("div",k,[(0,o._)("input",{class:(0,l.C_)(["form-control w540",{notfilled:r.isFilled2}]),placeholder:s.insert.modelPlaceholder,value:e.$store.state.updProd.model,onInput:t[1]||(t[1]=(...e)=>n.inputModel&&n.inputModel(...e))},null,42,v)]),(0,o.Uk)(" "+(0,l.zw)(s.insert.price)+": ",1),(0,o._)("div",y,[(0,o._)("input",{class:"form-control w100 text-center inline-block",placeholder:"",value:e.$store.state.updProd.price,onInput:t[2]||(t[2]=(...e)=>n.inputPrice&&n.inputPrice(...e))},null,40,F)]),(0,o.Wm)(a,{ref:"uplModule",uploadButton:s.insert.uploadButton,uploadedFiles:s.insert.uploadedFiles},null,8,["uploadButton","uploadedFiles"]),$,(0,o._)("h5",null,(0,l.zw)(s.insert.translationHeader)+":",1),(0,o.Uk)(" "+(0,l.zw)(s.insert.brand2Label)+": ",1),(0,o._)("div",T,[(0,o.wy)((0,o._)("input",{class:(0,l.C_)(["form-control w540"]),"onUpdate:modelValue":t[3]||(t[3]=t=>e.$store.state.updProd.brand2=t),placeholder:s.insert.brand2Placeholder},null,8,B),[[h.nr,e.$store.state.updProd.brand2]])]),(0,o.Uk)(" "+(0,l.zw)(s.insert.model2Label)+": ",1),(0,o._)("div",D,[(0,o.wy)((0,o._)("input",{class:(0,l.C_)(["form-control w540 mb-30"]),"onUpdate:modelValue":t[4]||(t[4]=t=>e.$store.state.updProd.model2=t),placeholder:s.insert.model2Placeholder},null,8,x),[[h.nr,e.$store.state.updProd.model2]])]),(0,o._)("button",{onClick:t[5]||(t[5]=(...e)=>n.checkForm&&n.checkForm(...e)),class:"btn2 greenBtn"},(0,l.zw)(s.insert.updButton),1)],32)])):((0,o.wg)(),(0,o.iD)("div",N,[U,(0,o._)("b",null,(0,l.zw)(e.$route.params.id),1),C,(0,o._)("div",{innerHTML:s.insert.notFound},null,8,E)]))]))}var I=s(1749),z=s(523),A=s(4143),S=s(1577),O=s(6265),M=s.n(O),R=s(6673),Z=s(5041),j={en:{text1:"English version of Notification<br>Изменения сохранены<br>Создана запись на втором языке",saved:"English version of Notification<br>Изменения сохранены",text2:"English version of Notification<br>Изменения сохранены<br>Запись на втором языке удалена",text3:"English version of Notification<br>Изменения сохранены<br>Но возникла ошибка при внесении изменений на втором языке",text4:"English version of Notification<br>Изменения сохранены<br>Но возникла непредвиденная ошибка (подробности в консоли)",text5_1:"English version of Notification<br>Ошибка. Ответ сервера: ",text5_2:"<br>Подробности в консоли",errNetwork:"English version of Notification<br>Нет подключения к серверу"},uk:{text1:"Изменения сохранены<br>Создана запись на втором языке",saved:"Изменения сохранены",text2:"Изменения сохранены<br>Запись на втором языке удалена",text3:"Изменения сохранены<br>Но возникла ошибка при внесении изменений на втором языке",text4:"Изменения сохранены<br>Но возникла непредвиденная ошибка (подробности в консоли)",text5_1:"Ошибка. Ответ сервера: ",text5_2:"<br>Подробности в консоли",errNetwork:"Нет подключения к серверу"}},G=s(2276),H={components:{MultiUpload:I.Z},mixins:[S.Z],props:{insert:{type:Object,required:!0}},data(){return{name:"FormEdit",isFilled1:!1,isFilled2:!1}},methods:{inputPrice(e){this.$store.commit("SetUpdPrice",this.checkPrice(e.target.value))},inputBrand(e){this.$store.commit("SetUpdBrand",e),0!==this.$store.state.updProd.brand.length?this.isFilled1=!1:this.isFilled1=!0},inputModel(e){this.$store.commit("SetUpdModel",e),0!==this.$store.state.updProd.model.length?this.isFilled2=!1:this.isFilled2=!0},checkForm(){0===this.$store.state.updProd.brand.length&&(this.isFilled1=!0),0===this.$store.state.updProd.model.length&&(this.isFilled2=!0),this.isFilled1||this.isFilled2||this.updateProduct()},async updateProduct(){console.log("\n\n@click ~~~~~~~~~~ updateProduct ~~~~~~~~~~ ");const e=M().create({withCredentials:!0});e.interceptors.request.use((e=>{console.log(">>>> customAxios - request (config)");let t=localStorage.getItem("AccessToken");return t&&(t=encodeURI(t)),e.headers.Authorization="Bearer "+t,e})),e.interceptors.response.use((e=>(console.log(">>>> customAxios - response (config)"),e)),(async t=>{console.log(">>>> customAxios - response (error)");const s=t.config;if(401==t.response.status&&t.config&&!t.config._isRetry&&(s._isRetry=!0,console.log("> 401 !!!!!!!!!!!: "),await this.tokenRefresh()))return console.log(" tokenRefresh TRUE!"),e.request(s);throw t}));const t=[...this.$store.getters.getPicsInDB,...this.$refs.uplModule.newPics];try{const s=await e.post(z.Ou.pathToAPI+"/products/update.php",JSON.stringify({id:this.$store.state.updProd.id,price:this.$store.state.updProd.price,pictures:t,language:this.$store.state.language,brand:this.$store.state.updProd.brand,model:this.$store.state.updProd.model,brand2:this.$store.state.updProd.brand2,model2:this.$store.state.updProd.model2}),{headers:{Accept:"application/json","Content-Type":"application/json"}});if(console.log("[3] response: ",s),"success"===s.data.status){switch(s.data.localeStatus){case"created":this.pushNotify(j[this.lang].text1,"notifyGreen");break;case"success":this.pushNotify(j[this.lang].saved,"notifyGreen");break;case"nothingToChanges":this.$store.commit("SetUpdProdTranslation",["",""]),this.pushNotify(j[this.lang].saved,"notifyGreen");break;case"deleted":this.$store.commit("SetUpdProdTranslation",["",""]),this.pushNotify(j[this.lang].text2,"notifyGreen");break;case"failed":this.pushNotify(j[this.lang].text3,"notifyOrange");break;default:this.pushNotify(j[this.lang].text4,"notifyOrange"),console.log(s);break}this.$refs.uplModule.delPicsToDelete(),this.getProducts("updateProduct()"),this.$refs.uplModule.hideBarAndClean(),this.$store.commit("UpdatePicsInDB",t),this.$store.commit("SetFreeze",!1)}else this.pushNotify(j[this.lang].text5_1+s.data.error+j[this.lang].text5_2,"notifyOrange"),console.log("Ошибка:"+s)}catch(s){if(console.log("e: ",s),"ERR_NETWORK"===s.code)return this.pushNotify(j[this.lang].errNetwork,"notifyOrange"),void console.log("Нет подключения к серверу");switch(s.response.data.status){case"expired":console.log(" expired [E1] (BOTH TOKENS IS EXPIRED) ");break;case"failed":console.log(" failed [E2]");break;case"denied":console.log(" denied [E3]");break;case"approved":console.log(" approved [E4] ");break;case"locked":console.log(" locked [E5] ");break;default:console.log("error [E6]: "+s);break}}}},mounted(){this.getUpdProd(this.$route.params.id,!0)},watch:{"$store.state.language":function(){console.log("["+this.name+"] -> language changes detected "),this.getUpdProd(this.$route.params.id,!0)}},setup(){const{tokenRefresh:e}=(0,A.Z)(),{lang:t}=(0,G.Z)("FormEdit"),{pushNotify:s}=(0,Z.Z)(),{getProducts:o,getUpdProd:l,checkPrice:i}=(0,R.Z)();return{define:z.Ou,tokenRefresh:e,lang:t,pushNotify:s,getProducts:o,getUpdProd:l,checkPrice:i}}},W=s(89);const q=(0,W.Z)(H,[["render",L]]);var K=q,V={en:{header:"Editing Auto",notFound:"Not found<br>Or no description in English<br>Try change language",brandLabel:"Brand",brandPlaceholder:"Type here brand",modelLabel:"Model",modelPlaceholder:"Type here model",price:"Price",uploadButton:"Upload Images",uploadedFiles:"Uploaded Files",translationHeader:"Translation into Ukrainian (not required)",brand2Label:"Brand",brand2Placeholder:"Type here the brand in Ukrainian",model2Label:"Model",model2Placeholder:"Type here the model in Ukrainian",updButton:"Save Changes"},uk:{header:"Редактирование авто",notFound:"Автотомобиль не найден.<br>Или отсутствует описание на украинском.<br>Попробуйте сменить язык.",brandLabel:"Марка",brandPlaceholder:"Напишите марку автомобиля",modelLabel:"Модель",modelPlaceholder:"Напишите модель",price:"Цена",uploadButton:"Загрузить",uploadedFiles:"Загружены файлы",translationHeader:"Перевод на английский (необязательно)",brand2Label:"Марка",brand2Placeholder:"Напишите марку на английском",model2Label:"Модель",model2Placeholder:"Напишите модель на английском",updButton:"Сохранить"}},Y={components:{LoginForm:p.Z,FormEdit:K},data(){return{name:"EditView"}},setup(){const{lang:e}=(0,G.Z)("EditView");return{define:z.Ou,lang:e,insert:V}}};const J=(0,W.Z)(Y,[["render",u]]);var X=J}}]);
//# sourceMappingURL=240.b41f5293.js.map