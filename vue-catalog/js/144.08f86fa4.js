"use strict";(self["webpackChunkvue_catalog"]=self["webpackChunkvue_catalog"]||[]).push([[144],{8144:function(e,s,l){l.d(s,{Z:function(){return A}});var t=l(3396),i=l(7139),o=l(9242);const n={class:"graybg"},a=["href"],r=["src"],c={class:"picName"},p=["href"],d=["onClick"],h=["src"],u={class:"multiSelect mb-15"},g={class:"flex mr-15"},f=(0,t._)("br",null,null,-1),m=["disabled"],P={class:"mt-20 mb-10"},w=(0,t._)("br",null,null,-1),_={class:"progress"},v={class:"pl-15"},y=["src"],T={className:"picName"},k=["onClick"],N=["src"];function b(e,s,l,b,F,D){return(0,t.wg)(),(0,t.iD)("div",n,[e.$store.state.updProd.pictures?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,i.C_)(["pl-15 smooth",e.$store.state.updProd.pictures.length>0&&"picsArrBg pt-15 pb-8 smooth-show"])},[(0,t._)("ul",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.$store.state.updProd.pictures,(e=>((0,t.wg)(),(0,t.iD)("li",{key:e,class:(0,i.C_)(["flex-list",e.includes("_COPY")&&"orange"])},[(0,t._)("a",{href:b.define.pathToUploads+"/"+e,className:"",target:"_blank",rel:"noreferrer noopener",title:""},[(0,t._)("img",{src:b.define.prevFolder2+e,class:"prev",alt:""},null,8,r)],8,a),(0,t._)("div",c,[(0,t._)("a",{href:b.define.pathToUploads+"/"+e,className:"",target:"_blank",rel:"noreferrer noopener",title:"Открыть в новой вкладке"},(0,i.zw)(e.length>b.maxNameLength?e.substr(0,b.maxNameLength-13)+" ... "+e.substr(-8,8):e),9,p)]),(0,t._)("div",{class:"delPic",onClick:s=>D.preparePicToDelete(e)},[(0,t._)("img",{src:b.define.pathToGraphics+"/delete2_20px.png",alt:""},null,8,h)],8,d)],2)))),128))])],2)):(0,t.kq)("",!0),(0,t._)("div",u,[(0,t._)("div",g,[(0,t._)("input",{type:"file",id:"files",ref:"files",accept:".png, .jpg, .jpeg, .gif",multiple:"",onChange:s[0]||(s[0]=e=>D.handleFilesUpload())},null,544),f,(0,t._)("button",{disabled:F.uplBtnBlock,onClick:s[1]||(s[1]=e=>D.submitFiles())},(0,i.zw)(l.uploadButton),9,m)]),(0,t._)("div",{class:(0,i.C_)(["smooth",F.isInProgress&&"smooth-show",""])},[(0,t._)("div",P,[(0,t.Uk)((0,i.zw)(F.uploadPercentage)+" % ",1),w,(0,t._)("div",_,[(0,t._)("div",{class:"progress-bar",style:(0,i.j5)({width:+F.uploadPercentage+"%"})},null,4)])])],2),(0,t.Wm)(o.uT,{name:"fade"},{default:(0,t.w5)((()=>[(0,t.wy)((0,t._)("div",{class:"mt-10 mb-10"},(0,i.zw)(l.uploadedFiles)+" ("+(0,i.zw)(F.newPics.length)+"):",513),[[o.F8,F.newPics.length>0]])])),_:1}),(0,t._)("ul",v,[(0,t.Wm)(o.W3,{name:"list"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(F.newPics,(e=>((0,t.wg)(),(0,t.iD)("li",{key:e,class:(0,i.C_)(["flex-list",e.includes("_COPY")&&"orange"])},[(0,t._)("img",{src:b.define.prevFolder+e,class:"prev",alt:""},null,8,y),(0,t._)("div",T,(0,i.zw)(e.length>b.maxNameLength?e.substr(0,b.maxNameLength-13)+" ... "+e.substr(-8,8):e),1),(0,t._)("div",{className:"delPic",onClick:s=>D.deleteNewPics(e)},[(0,t._)("img",{src:b.define.pathToGraphics+"/delete2_20px.png",alt:""},null,8,N)],8,k)],2)))),128))])),_:1})])])])}var F=l(6265),D=l.n(F),B=l(523),C=l(5041),E={en:{errNetwork:"English version of Notification<br>Нет подключения к серверу",fileSaveError:"English version of Notification<br>Ошибка. Возможно тип файла не поддерживается. Загружайте изображения JPG, PNG или GIF",defaultError:"English version of Notification<br>Возникла ошибка (подробности в консоли)"},uk:{errNetwork:"Нет подключения к серверу",fileSaveError:"Ошибка. Возможно тип файла не поддерживается. Загружайте изображения JPG, PNG или GIF",defaultError:"Возникла ошибка (подробности в консоли)"}},$=l(2276),x={props:{uploadButton:{type:String,default:"Загрузить"},uploadedFiles:{type:String,default:"Загружены файлы"}},data(){return{files:"",newPics:[],picsToDelete:[],isInProgress:!1,uploadPercentage:0,uplBtnBlock:!0}},methods:{handleFilesUpload(){this.files=this.$refs.files.files,this.isInProgress=!0,console.log("this.$refs.files.files.length: ",this.$refs.files.files.length),this.$refs.files.files.length>0?this.uplBtnBlock=!1:this.uplBtnBlock=!0},async submitFiles(){let e;this.uploadPercentage=0,this.uplBtnBlock=!0;let s=new FormData;for(let t=0;t<this.files.length;t++)e=this.files[t],s.append("files["+t+"]",e);try{const e=await D()({method:"post",url:B.Ou.pathToAPI+"/multiupload/multiupload.php",data:s,withCredentials:!0,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){this.uploadPercentage=Math.round(100*e.loaded/e.total)}.bind(this)});if(console.log("response: ",e),!e.data.uplFiles)return this.pushNotify(E[this.lang].fileSaveError,"notifyOrange"),void console.log("! Не получен response.data.uplFiles");if(e.data)for(let s=0;s<e.data.uplFiles.length;s++)this.newPics.includes(e.data.uplFiles[s])||this.newPics.push(e.data.uplFiles[s]);else console.log("Ошибка при передаче или сохранении файлов.\nСервер отвечает (код 200). Но нет подтверждения от multiupload.php, что файлы сохранены")}catch(l){if("ERR_NETWORK"===l.code)return this.pushNotify(E[this.lang].errNetwork,"notifyOrange"),void console.log("Нет подключения к серверу");switch(l.response.data.status){default:this.pushNotify(E[this.lang].defaultError,"notifyOrange"),console.log("Error: "+l);break}}},preparePicToDelete(e){if(!e&&"string"!==typeof e)return void console.log("Ошибка: filename не передан или не string [см. preparePicToDelete()]");const s=this.$store.state.updProd.pictures.filter((s=>s!==e));this.picsToDelete.push(e),this.$store.commit("UpdatePicsInDB",s)},delPicsToDelete(){this.picsToDelete.length>0&&this.deleteFiles(this.picsToDelete),this.picsToDelete=[]},async deleteNewPics(e){if(!this.newPics.length)return;console.log("1) filesToBeDel: ",e),console.log("typeof: ",typeof e),e="string"===typeof e?[e]:this.newPics,console.log("2) filesToBeDel: ",e),console.log("Удалить из newPics то что вернет deleteFiles() ");let s=await this.deleteFiles(e);if(s){for(let e=0;e<s.length;e++)this.newPics=this.newPics.filter((l=>l!==s[e]));0===this.newPics.length&&this.hideBarAndClean()}else console.log("deletedFiles - false")},async deleteFiles(e){if(e&&"string"!==typeof e)try{const s=await D()({method:"post",url:B.Ou.pathToAPI+"/multiupload/delete_uplfiles.php",data:{filesToBeDel:e},withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}});return console.log("response: ",s),s.data?0===s.data.doneFiles.length?(console.log("~~~"),console.log("Нет подтверждения от сервера"),console.log("Комментарии: ",s.data.comments),console.log("response: ",s),console.log("~~~"),void alert("Нет подтверждения от сервера (см. консоль)")):s.data.doneFiles:(alert("Ошибка (см. консоль)"),void console.log("Ошибка при передаче или сохранении файлов.\nСервер отвечает (код 200). Но нет подтверждения от multiupload.php, что файлы сохранены"))}catch(s){return void console.log(s)}else console.log("Ошибка: функции deleteFiles не передан массив (обязательный параметр)")},getBackFiles(){this.picsToDelete.length>0&&this.$store.commit("AddToPicsInDB",this.picsToDelete),this.picsToDelete=[]},hideBarAndClean(){this.newPics.length>0&&(this.newPics=[]);const e=350,s=600;setTimeout((()=>{this.isInProgress=!1}),e),this.$refs.files.value="",setTimeout((()=>{this.uploadPercentage=0}),e+s)}},setup(){const{lang:e}=(0,$.Z)(),{pushNotify:s}=(0,C.Z)();return{define:B.Ou,maxNameLength:B.AS,lang:e,pushNotify:s}}},I=l(89);const O=(0,I.Z)(x,[["render",b]]);var A=O}}]);
//# sourceMappingURL=144.08f86fa4.js.map