"use strict";(self["webpackChunkvue_catalog"]=self["webpackChunkvue_catalog"]||[]).push([[14],{7897:function(e,t,l){l.d(t,{Z:function(){return A}});var s=l(3396),o=l(7139),i=l(9242);const r={class:"graybg"},n=["href"],a=["src"],d={class:"picName"},c=["href"],p=["onClick"],u=["src"],h={class:"multiSelect mb-15"},g={class:"flex mr-15"},m=(0,s._)("br",null,null,-1),f=["disabled"],w={class:"mt-20 mb-10"},P=(0,s._)("br",null,null,-1),b={class:"progress"},_={class:"pl-15"},k=["src"],v={className:"picName"},F=["onClick"],y=["src"];function $(e,t,l,$,B,T){return(0,s.wg)(),(0,s.iD)("div",r,[e.$store.state.updProd.pictures?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,o.C_)(["pl-15 smooth",e.$store.state.updProd.pictures.length>0&&"picsArrBg pt-15 pb-6 smooth-show"])},[(0,s._)("ul",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.$store.state.updProd.pictures,(e=>((0,s.wg)(),(0,s.iD)("li",{key:e,class:(0,o.C_)(["flex-list",e.includes("_COPY")&&"orange"])},[(0,s._)("a",{href:$.define.pathToUploads+"/"+e,className:"",target:"_blank",rel:"noreferrer noopener",title:""},[(0,s._)("img",{src:$.define.prevFolder2+e,class:"prev",alt:""},null,8,a)],8,n),(0,s._)("div",d,[(0,s._)("a",{href:$.define.pathToUploads+"/"+e,className:"",target:"_blank",rel:"noreferrer noopener",title:"Открыть в новой вкладке"},(0,o.zw)(e.length>$.maxNameLength?e.substr(0,$.maxNameLength-13)+" ... "+e.substr(-8,8):e),9,c)]),(0,s._)("div",{class:"delPic",onClick:t=>T.preparePicToDelete(e)},[(0,s._)("img",{src:$.define.pathToGraphics+"/delete2_20px.png",alt:""},null,8,u)],8,p)],2)))),128))])],2)):(0,s.kq)("",!0),(0,s._)("div",h,[(0,s._)("div",g,[(0,s._)("input",{type:"file",id:"files",ref:"files",accept:".png, .jpg, .jpeg, .gif",multiple:"",onChange:t[0]||(t[0]=e=>T.handleFilesUpload())},null,544),m,(0,s._)("button",{disabled:B.uplBtnBlock,onClick:t[1]||(t[1]=e=>T.submitFiles())},(0,o.zw)(l.uploadButton),9,f)]),(0,s._)("div",{class:(0,o.C_)(["smooth",B.isInProgress&&"smooth-show",""])},[(0,s._)("div",w,[(0,s.Uk)((0,o.zw)(B.uploadPercentage)+" % ",1),P,(0,s._)("div",b,[(0,s._)("div",{class:"progress-bar",style:(0,o.j5)({width:+B.uploadPercentage+"%"})},null,4)])])],2),(0,s.Wm)(i.uT,{name:"fade"},{default:(0,s.w5)((()=>[(0,s.wy)((0,s._)("div",{class:"mt-10 mb-10"},(0,o.zw)(l.uploadedFiles)+" ("+(0,o.zw)(B.newPics.length)+"):",513),[[i.F8,B.newPics.length>0]])])),_:1}),(0,s._)("ul",_,[(0,s.Wm)(i.W3,{name:"list"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(B.newPics,(e=>((0,s.wg)(),(0,s.iD)("li",{key:e,class:(0,o.C_)(["flex-list",e.includes("_COPY")&&"orange"])},[(0,s._)("img",{src:$.define.prevFolder+e,class:"prev",alt:""},null,8,k),(0,s._)("div",v,(0,o.zw)(e.length>$.maxNameLength?e.substr(0,$.maxNameLength-13)+" ... "+e.substr(-8,8):e),1),(0,s._)("div",{className:"delPic",onClick:t=>T.deleteNewPics(e)},[(0,s._)("img",{src:$.define.pathToGraphics+"/delete2_20px.png",alt:""},null,8,y)],8,F)],2)))),128))])),_:1})])])])}var B=l(6265),T=l.n(B),N=l(523),C={props:{uploadButton:{type:String,default:"Загрузить"},uploadedFiles:{type:String,default:"Загружены файлы"}},data(){return{files:"",newPics:[],picsToDelete:[],isInProgress:!1,uploadPercentage:0,uplBtnBlock:!0}},methods:{handleFilesUpload(){this.files=this.$refs.files.files,this.isInProgress=!0,console.log("this.$refs.files.files.length: ",this.$refs.files.files.length),this.$refs.files.files.length>0?this.uplBtnBlock=!1:this.uplBtnBlock=!0},async submitFiles(){let e;this.uploadPercentage=0,this.uplBtnBlock=!0;let t=new FormData;for(let s=0;s<this.files.length;s++)e=this.files[s],t.append("files["+s+"]",e);try{const e=await T()({method:"post",url:N.Ou.pathToAPI+"/multiupload/multiupload.php",data:t,withCredentials:!0,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){this.uploadPercentage=Math.round(100*e.loaded/e.total)}.bind(this)});if(console.log("response: ",e),!e.data.uplFiles)return console.log("! Не получен response.data.uplFiles"),void alert("Ошибка на сервере при сохранении файлов (см. консоль)");if(e.data){this.$store.commit("SetFreeze",!0);for(let t=0;t<e.data.uplFiles.length;t++)this.newPics.includes(e.data.uplFiles[t])||this.newPics.push(e.data.uplFiles[t])}else alert("Ошибка (см. консоль)"),console.log("Ошибка при передаче или сохранении файлов.\nСервер отвечает (код 200). Но нет подтверждения от multiupload.php, что файлы сохранены")}catch(l){console.log(l)}},preparePicToDelete(e){if(!e&&"string"!==typeof e)return void console.log("Ошибка: filename не передан или не string [см. preparePicToDelete()]");this.$store.commit("SetFreeze",!0);const t=this.$store.state.updProd.pictures.filter((t=>t!==e));this.picsToDelete.push(e),this.$store.commit("UpdatePicsInDB",t)},delPicsToDelete(){this.picsToDelete.length>0&&this.deleteFiles(this.picsToDelete),this.picsToDelete=[]},async deleteNewPics(e){if(!this.newPics.length)return;console.log("1) filesToBeDel: ",e),console.log("typeof: ",typeof e),e="string"===typeof e?[e]:this.newPics,console.log("2) filesToBeDel: ",e),console.log("Удалить из newPics то что вернет deleteFiles() ");let t=await this.deleteFiles(e);if(t){for(let e=0;e<t.length;e++)this.newPics=this.newPics.filter((l=>l!==t[e]));0===this.newPics.length&&this.hideBarAndClean()}else console.log("deletedFiles - false")},async deleteFiles(e){if(e&&"string"!==typeof e)try{const t=await T()({method:"post",url:N.Ou.pathToAPI+"/multiupload/delete_uplfiles.php",data:{filesToBeDel:e},withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}});return console.log("response: ",t),t.data?0===t.data.doneFiles.length?(console.log("~~~"),console.log("Нет подтверждения от сервера"),console.log("Комментарии: ",t.data.comments),console.log("response: ",t),console.log("~~~"),void alert("Нет подтверждения от сервера (см. консоль)")):t.data.doneFiles:(alert("Ошибка (см. консоль)"),void console.log("Ошибка при передаче или сохранении файлов.\nСервер отвечает (код 200). Но нет подтверждения от multiupload.php, что файлы сохранены"))}catch(t){return void console.log(t)}else console.log("Ошибка: функции deleteFiles не передан массив (обязательный параметр)")},getBackFiles(){this.picsToDelete.length>0&&this.$store.commit("AddToPicsInDB",this.picsToDelete),this.picsToDelete=[]},hideBarAndClean(){this.newPics.length>0&&(this.newPics=[]);const e=350,t=600;setTimeout((()=>{this.isInProgress=!1}),e),this.$refs.files.value="",setTimeout((()=>{this.uploadPercentage=0}),e+t)}},setup(){return{define:N.Ou,maxNameLength:N.AS}}},D=l(89);const x=(0,D.Z)(C,[["render",$]]);var A=x},5014:function(e,t,l){l.r(t),l.d(t,{default:function(){return R}});var s=l(3396),o=l(7139);const i={class:"home"},r={key:0},n={key:1};function a(e,t,l,a,d,c){const p=(0,s.up)("login-form"),u=(0,s.up)("form-add");return(0,s.wg)(),(0,s.iD)("div",i,[(0,s._)("h1",null,(0,o.zw)(a.insert[a.lang].header),1),e.$store.state.isAuth?((0,s.wg)(),(0,s.iD)("div",n,[(0,s.Wm)(u,{insert:a.insert[a.lang]},null,8,["insert"])])):((0,s.wg)(),(0,s.iD)("div",r,[(0,s.Wm)(p)]))])}var d=l(5950),c=l(9242);const p={class:"form-group mb-10"},u=["value","placeholder"],h={class:"form-group mb-10"},g=["value","placeholder"],m={class:"form-group mb-20"},f=["value"],w=(0,s._)("hr",{class:"w540 hr-dashed"},null,-1),P={class:"form-group mb-10"},b=["placeholder"],_={class:"form-group mb-10"},k=["placeholder"],v=(0,s._)("br",null,null,-1);function F(e,t,l,i,r,n){const a=(0,s.up)("multi-upload");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("form",{onSubmit:t[6]||(t[6]=(0,c.iM)((()=>{}),["prevent"]))},[(0,s.Uk)((0,o.zw)(l.insert.brand.label)+": ",1),(0,s._)("div",p,[(0,s._)("input",{class:(0,o.C_)(["form-control w540",{notfilled:r.isFilled1}]),value:e.$store.state.newProd.brand,onInput:t[0]||(t[0]=(...e)=>n.inputBrand&&n.inputBrand(...e)),placeholder:l.insert.brand.placeholder},null,42,u)]),(0,s.Uk)((0,o.zw)(l.insert.model.label)+": ",1),(0,s._)("div",h,[(0,s._)("input",{class:(0,o.C_)(["form-control w540",{notfilled:r.isFilled2}]),value:e.$store.state.newProd.model,onInput:t[1]||(t[1]=(...e)=>n.inputModel&&n.inputModel(...e)),placeholder:l.insert.model.placeholder},null,42,g)]),(0,s.Uk)((0,o.zw)(l.insert.price)+": ",1),(0,s._)("div",m,[(0,s._)("input",{class:"form-control w100 text-center inline-block",value:e.$store.state.newProd.price,onInput:t[2]||(t[2]=(...e)=>n.inputPrice&&n.inputPrice(...e)),placeholder:""},null,40,f)]),(0,s.Wm)(a,{ref:"uplModule",uploadButton:l.insert.uploadButton,uploadedFiles:l.insert.uploadedFiles},null,8,["uploadButton","uploadedFiles"]),w,(0,s._)("h5",null,(0,o.zw)(l.insert.translationHeader)+":",1),(0,s.Uk)(" "+(0,o.zw)(l.insert.brand2.label)+": ",1),(0,s._)("div",P,[(0,s.wy)((0,s._)("input",{class:(0,o.C_)(["form-control w540"]),"onUpdate:modelValue":t[3]||(t[3]=t=>e.$store.state.newProd.brand2=t),placeholder:l.insert.brand2.placeholder},null,8,b),[[c.nr,e.$store.state.newProd.brand2]])]),(0,s.Uk)((0,o.zw)(l.insert.model2.label)+": ",1),(0,s._)("div",_,[(0,s.wy)((0,s._)("input",{class:(0,o.C_)(["form-control w540 mb-30"]),"onUpdate:modelValue":t[4]||(t[4]=t=>e.$store.state.newProd.model2=t),placeholder:l.insert.model2.placeholder},null,8,k),[[c.nr,e.$store.state.newProd.model2]])]),(0,s._)("button",{onClick:t[5]||(t[5]=(...e)=>n.checkForm&&n.checkForm(...e)),class:"btn2 greenBtn"},(0,o.zw)(l.insert.addButton),1)],32),v],64)}var y=l(7897),$=l(523),B=l(4143),T=l(5041),N=l(6265),C=l.n(N),D=l(6673),x={en:{errNetwork:"English version of Notification<br>Нет подключения к серверу",text1:"English version of Notification<br>Автомобиль успешно добавлен",text5_1:"English version of Notification<br>Ошибка. Ответ сервера: ",text5_2:"<br>Подробности в консоли"},uk:{errNetwork:"Нет подключения к серверу",text1:"Автомобиль успешно добавлен",text5_1:"Ошибка. Ответ сервера: ",text5_2:"<br>Подробности в консоли"}},A=l(2276),U={components:{MultiUpload:y.Z},props:{insert:{type:Object,required:!0}},data(){return{name:"FormAdd",isFilled1:!1,isFilled2:!1}},methods:{inputPrice(e){this.$store.commit("SetNewPrice",this.checkPrice(e.target.value))},inputBrand(e){this.$store.commit("SetNewBrand",e),0!==this.$store.state.newProd.brand.length?this.isFilled1=!1:this.isFilled1=!0},inputModel(e){this.$store.commit("SetNewModel",e),0!==this.$store.state.newProd.model.length?this.isFilled2=!1:this.isFilled2=!0},checkForm(){0===this.$store.state.newProd.brand.length&&(this.isFilled1=!0),0===this.$store.state.newProd.model.length&&(this.isFilled2=!0),this.isFilled1||this.isFilled2||this.createProduct()},async createProduct(){console.log("\n\n@click ~~~~~~~~~~ createProduct ~~~~~~~~~~ ");const e=C().create({withCredentials:!0});e.interceptors.request.use((e=>{console.log(">>>> customAxios - request (config)");let t=localStorage.getItem("AccessToken");return t&&(t=encodeURI(t)),e.headers.Authorization="Bearer "+t,e})),e.interceptors.response.use((e=>(console.log(">>>> customAxios - response (config)"),e)),(async t=>{console.log(">>>> customAxios - response (error)");const l=t.config;if(401==t.response.status&&t.config&&!t.config._isRetry&&(l._isRetry=!0,console.log("> 401 !!!!!!!!!!!: "),await this.tokenRefresh()))return console.log(" tokenRefresh TRUE!"),e.request(l);throw t}));try{const t=await e.post($.Ou.pathToAPI+"/products/create.php",JSON.stringify({price:this.$store.state.newProd.price,pictures:this.$refs.uplModule.newPics,language:this.$store.state.language,brand:this.$store.state.newProd.brand,model:this.$store.state.newProd.model,brand2:this.$store.state.newProd.brand2,model2:this.$store.state.newProd.model2}),{headers:{Accept:"application/json","Content-Type":"application/json"}});console.log("[3] response: ",t),"success"===t.data.status?(this.$store.commit("SetNewId",t.data.id),this.$store.commit("SetNewPictures",this.$refs.uplModule.newPics),this.getProducts("createProduct()"),this.$store.commit("ClearNewProd"),this.$refs.uplModule.hideBarAndClean(),this.$store.commit("SetFreeze",!1),this.pushNotify(x[this.lang].text1,"notifyGreen")):(this.pushNotify(x[this.lang].text5_1+t.data.error+x[this.lang].text5_2,"notifyOrange"),console.log("Ошибка:"+t))}catch(t){if(!t.response)return;if(console.log("e: ",t),"ERR_NETWORK"===t.code)return this.pushNotify(x[this.lang].errNetwork,"notifyOrange"),void console.log("Нет подключения к серверу");switch(t.response.data.status){case"expired":console.log(" expired [E1] (BOTH TOKENS IS EXPIRED) ");break;case"failed":console.log(" failed [E2]");break;case"denied":console.log(" denied [E3]");break;case"approved":console.log(" approved [E4] ");break;case"locked":console.log(" locked [E5] ");break;default:console.log("error [E6]: "+t);break}}}},beforeMount(){this.$store.commit("ClearUpdProd")},setup(){const{tokenRefresh:e}=(0,B.Z)(),{lang:t}=(0,A.Z)("FormAdd"),{pushNotify:l}=(0,T.Z)(),{checkPrice:s,getProducts:o}=(0,D.Z)();return{tokenRefresh:e,lang:t,pushNotify:l,checkPrice:s,getProducts:o}}},z=l(89);const I=(0,z.Z)(U,[["render",F]]);var S=I,E={en:{header:"Adding Auto",brand:{label:"Brand",placeholder:"Type here brand"},model:{label:"Model",placeholder:"Type here model"},price:"Price",uploadButton:"Upload Images",uploadedFiles:"Uploaded Files",translationHeader:"Translation into Ukrainian (not required)",brand2:{label:"Brand",placeholder:"Type here the brand in Ukrainian"},model2:{label:"Model",placeholder:"Type here the model in Ukrainian"},addButton:"Add Auto"},uk:{header:"Добавление авто",brand:{label:"Марка",placeholder:"Напишите марку автомобиля"},model:{label:"Модель",placeholder:"Напишите модель"},price:"Цена",uploadButton:"Загрузить",uploadedFiles:"Загружены файлы",translationHeader:"Перевод на английский (необязательно)",brand2:{label:"Марка",placeholder:"Напишите марку на английском"},model2:{label:"Модель",placeholder:"Напишите модель на английском"},addButton:"Добавить"}},M={components:{LoginForm:d.Z,FormAdd:S},setup(){const{lang:e}=(0,A.Z)("AddView");return{lang:e,insert:E}}};const O=(0,z.Z)(M,[["render",a]]);var R=O}}]);
//# sourceMappingURL=14.e42969fb.js.map