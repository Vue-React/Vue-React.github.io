"use strict";(self["webpackChunkvue_catalog"]=self["webpackChunkvue_catalog"]||[]).push([[297],{297:function(e,t,s){s.d(t,{Z:function(){return A}});var l=s(3396),i=s(7139),o=s(9242);const n={class:"graybg"},a=["href"],r=["src"],c={class:"picName"},d=["href"],p=["onClick"],u=["src"],h={class:"multiSelect mb-15"},g={class:"flex mr-15"},f=(0,l._)("br",null,null,-1),m=["disabled"],P={class:"mt-20 mb-10"},w=(0,l._)("br",null,null,-1),_={class:"progress"},v={class:"pl-15"},k=["src"],y={class:"picName"},b=["onClick"],T=["src"];function F(e,t,s,F,N,D){return(0,l.wg)(),(0,l.iD)("div",n,[e.$store.state.updProd.pictures?((0,l.wg)(),(0,l.iD)("div",{key:0,class:(0,i.C_)(["pl-15 smooth",e.$store.state.updProd.pictures.length>0&&"picsArrBg pt-15 pb-8 smooth-show"])},[(0,l._)("ul",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.$store.state.updProd.pictures,(e=>((0,l.wg)(),(0,l.iD)("li",{key:e,class:(0,i.C_)(["flex-list",e.includes("_COPY")&&"orange"])},[(0,l._)("a",{href:F.define.pathToUploads+"/"+e,target:"_blank",rel:"noreferrer noopener",title:""},[(0,l._)("img",{src:F.define.prevFolder2+e,class:"prev",alt:""},null,8,r)],8,a),(0,l._)("div",c,[(0,l._)("a",{href:F.define.pathToUploads+"/"+e,target:"_blank",rel:"noreferrer noopener",title:"Открыть в новой вкладке"},(0,i.zw)(e.length>F.maxNameLength?e.substr(0,F.maxNameLength-13)+" ... "+e.substr(-8,8):e),9,d)]),(0,l._)("div",{class:"delPic",onClick:t=>D.preparePicToDelete(e)},[(0,l._)("img",{src:F.define.pathToGraphics+"/delete2_20px.png",alt:""},null,8,u)],8,p)],2)))),128))])],2)):(0,l.kq)("",!0),(0,l._)("div",h,[(0,l._)("div",g,[(0,l._)("input",{type:"file",id:"files",ref:"files",accept:".png, .jpg, .jpeg, .gif",multiple:"",onChange:t[0]||(t[0]=e=>D.handleFilesUpload())},null,544),f,(0,l._)("button",{disabled:N.uplBtnBlock,onClick:t[1]||(t[1]=e=>D.submitFiles())},(0,i.zw)(s.uploadButton),9,m)]),(0,l._)("div",{class:(0,i.C_)(["smooth",N.isInProgress&&"smooth-show",""])},[(0,l._)("div",P,[(0,l.Uk)((0,i.zw)(N.uploadPercentage)+" % ",1),w,(0,l._)("div",_,[(0,l._)("div",{class:"progress-bar",style:(0,i.j5)({width:+N.uploadPercentage+"%"})},null,4)])])],2),(0,l.Wm)(o.uT,{name:"fade"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l._)("div",{class:"mt-10 mb-10"},(0,i.zw)(s.uploadedFiles)+" ("+(0,i.zw)(N.newPics.length)+"):",513),[[o.F8,N.newPics.length>0]])])),_:1}),(0,l._)("ul",v,[(0,l.Wm)(o.W3,{name:"list"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(N.newPics,(e=>((0,l.wg)(),(0,l.iD)("li",{key:e,class:(0,i.C_)(["flex-list",e.includes("_COPY")&&"orange"])},[(0,l._)("img",{src:F.define.prevFolder+e,class:"prev",alt:""},null,8,k),(0,l._)("div",y,(0,i.zw)(e.length>F.maxNameLength?e.substr(0,F.maxNameLength-13)+" ... "+e.substr(-8,8):e),1),(0,l._)("div",{class:"delPic",onClick:t=>D.deleteNewPics(e)},[(0,l._)("img",{src:F.define.pathToGraphics+"/delete2_20px.png",alt:""},null,8,T)],8,b)],2)))),128))])),_:1})])])])}var N=s(6265),D=s.n(N),C=s(523),B=s(5041),E={en:{errNetwork:"English version of Notification<br>Нет подключения к серверу",fileSaveError:"English version of Notification<br>Ошибка. Возможно тип файла не поддерживается. Загружайте изображения JPG, PNG или GIF",defaultError:"English version of Notification<br>Возникла ошибка (подробности в консоли)"},uk:{errNetwork:"Нет подключения к серверу",fileSaveError:"Ошибка. Возможно тип файла не поддерживается. Загружайте изображения JPG, PNG или GIF",defaultError:"Возникла ошибка (подробности в консоли)"}},x=s(2276),I={props:{uploadButton:{type:String,default:"Загрузить"},uploadedFiles:{type:String,default:"Загружены файлы"}},data(){return{files:"",newPics:[],picsToDelete:[],isInProgress:!1,uploadPercentage:0,uplBtnBlock:!0}},methods:{handleFilesUpload(){this.files=this.$refs.files.files,this.isInProgress=!0,this.$refs.files.files.length>0?this.uplBtnBlock=!1:this.uplBtnBlock=!0},async submitFiles(){let e;this.uploadPercentage=0,this.uplBtnBlock=!0;let t=new FormData;for(let l=0;l<this.files.length;l++)e=this.files[l],t.append("files["+l+"]",e);try{const e=await D()({method:"post",url:C.Ou.pathToAPI+"/multiupload/multiupload.php",data:t,withCredentials:!0,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){this.uploadPercentage=Math.round(100*e.loaded/e.total)}.bind(this)});if(!e.data.uplFiles)return void this.pushNotify(E[this.lang].fileSaveError,"notifyOrange");if(e.data)for(let t=0;t<e.data.uplFiles.length;t++)this.newPics.includes(e.data.uplFiles[t])||this.newPics.push(e.data.uplFiles[t]);else console.log("Ошибка при передаче или сохранении файлов.\nСервер отвечает (код 200). Но нет подтверждения от multiupload.php, что файлы сохранены")}catch(s){if("ERR_NETWORK"===s.code)return void this.pushNotify(E[this.lang].errNetwork,"notifyOrange");switch(s.response.data.status){default:this.pushNotify(E[this.lang].defaultError,"notifyOrange"),console.log("Error: "+s);break}}},preparePicToDelete(e){if(!e&&"string"!==typeof e)return void console.log("Ошибка: filename не передан или не string [см. preparePicToDelete()]");const t=this.$store.state.updProd.pictures.filter((t=>t!==e));this.picsToDelete.push(e),this.$store.commit("UpdatePicsInDB",t)},delPicsToDelete(){this.picsToDelete.length>0&&this.deleteFiles(this.picsToDelete),this.picsToDelete=[]},async deleteNewPics(e){if(!this.newPics.length)return;e="string"===typeof e?[e]:this.newPics;let t=await this.deleteFiles(e);if(t){for(let e=0;e<t.length;e++)this.newPics=this.newPics.filter((s=>s!==t[e]));0===this.newPics.length&&this.hideBarAndClean()}},async deleteFiles(e){if(e&&"string"!==typeof e)try{const t=await D()({method:"post",url:C.Ou.pathToAPI+"/multiupload/delete_uplfiles.php",data:{filesToBeDel:e},withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}});return t.data?0===t.data.doneFiles.length?(console.log("~~~"),console.log("Нет подтверждения от сервера"),console.log("Комментарии: ",t.data.comments),console.log("response: ",t),void console.log("~~~")):t.data.doneFiles:void console.log("Ошибка при передаче или сохранении файлов.\nСервер отвечает (код 200). Но нет подтверждения от multiupload.php, что файлы сохранены")}catch(t){return void console.log(t)}else console.log("Ошибка: функции deleteFiles не передан массив (обязательный параметр)")},getBackFiles(){this.picsToDelete.length>0&&this.$store.commit("AddToPicsInDB",this.picsToDelete),this.picsToDelete=[]},hideBarAndClean(){this.newPics.length>0&&(this.newPics=[]);const e=350,t=600;setTimeout((()=>{this.isInProgress=!1}),e),this.$refs.files.value="",setTimeout((()=>{this.uploadPercentage=0}),e+t)}},setup(){const{lang:e}=(0,x.Z)(),{pushNotify:t}=(0,B.Z)();return{define:C.Ou,maxNameLength:C.AS,lang:e,pushNotify:t}}},O=s(89);const $=(0,O.Z)(I,[["render",F]]);var A=$}}]);
//# sourceMappingURL=297.fcf437fd.js.map